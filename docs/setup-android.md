# Android アプリセットアップ

## 前提条件

- **Android Studio** Ladybug (2024.2) 以降
- **JDK 17** (Android Studio に同梱のもので OK)
- **Android 9 (API 28) 以上**の実機またはエミュレータ

## アプリのビルド

1. Android Studio で `app-android/` ディレクトリをプロジェクトとして開く
2. 必要に応じて `app/build.gradle.kts` の `applicationId` を変更する（デフォルトのままでも動作します）
3. Gradle sync が自動で走る（初回は数分かかる場合がある）
4. 実機を USB 接続するか、エミュレータを起動する
5. **Run** (▶) でビルド＆インストール

## 初期設定

1. アプリを起動し、画面下部の **Settings** タブを開く
2. **Server URL** にサーバのアドレスを入力（例: `http://192.168.1.100:3939`）
3. **ルームキー** に任意の文字列を入力（8〜128文字、同じキーを設定したデバイス同士がデータを共有します）
4. 設定画面上部のトグルをオンにして接続を開始

## 通知の許可

Android 13 (API 33) 以降では、アプリ初回起動時に **通知の許可ダイアログ** が表示されます。「許可」を選択してください。

通知を許可しないと、承認リクエストの通知が届きません。後から変更する場合は、端末の **設定 → アプリ → PromptRelay → 通知** から有効にできます。

## 注意事項

- **HTTP 通信**: `android:usesCleartextTraffic="true"` が設定済みのため、LAN 内の HTTP サーバにそのまま接続できます。インターネット経由で使う場合は HTTPS を推奨します。
- **デバッグビルド**: 個人利用のソースビルド専用です。Google Play での配布は想定していません。
- **バックグラウンド通信**: WebSocket のフォアグラウンドサービスを使用しており、通知バーに常駐アイコンが表示されます。
- **接続エラー時の動作**: URL やルームキーの設定ミス、認証エラーの場合は自動リトライを停止してステータスにエラー内容を表示します。接続トグルはユーザーの意図を反映し、一時的なネットワーク障害では自動 OFF しません。ネットワーク復帰時に自動で再接続します。
